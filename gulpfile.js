'use strict';

var gulp = require('gulp');
var nodemon = require('gulp-nodemon');
var uglify = require('gulp-uglify');
var concat = require('gulp-concat');
var gutil = require('gulp-util');

gulp.paths = {
  scripts: ['gulp/*.js',
    'app.js',
    'gulpfile.js',
    'public/file-upload/*.js',
    'public/file-list/*.js',
    'public/router.js',
    'config/*.js',
    'app/**/*.js'
  ],
};

gulp.task('sourceIntegration', function () {

  return gulp.src(['./public/router.js',
      './public/file-upload/file-upload-controller.js',
      './public/file-upload/file-upload-directive.js',
      './public/file-upload/file-upload-service.js',
      './public/file-list/file-list-controller.js',
      './public/file-list/file-list-service.js'
    ])
    .pipe(concat('./public/source-integrated-file.js'))
    .pipe(uglify().on('error', gutil.log))
    .pipe(gulp.dest('./'));
});

gulp.task('start', ['beautify', 'sourceIntegration'], function () {
  nodemon({
    scripts: './bin/www'
  });
});

/**
 * separating gulp tasks concerns inside the gulp dir
 * NOTE: tasks in this directory have been adapted from
 * tasks generated by github.com/kosz/generator-modular
 */
require('require-dir')('./gulp');
